# ADR-003: slog による構造化ログ

## ステータス

Accepted

## コンテキスト

本番環境での運用を見据え、適切なログ基盤を選定する必要があった。

以下の要件を満たす必要があった:
- 構造化ログ（JSON 形式）のサポート
- ログレベルの切り替え
- リクエスト ID によるトレーサビリティ
- パフォーマンスへの影響が最小限

## 決定

**Go 1.21+ 標準の `log/slog`** を採用する。

```go
// 開発環境: テキスト形式
// 本番環境: JSON 形式
func Init(env string) {
    if env == "production" {
        handler = slog.NewJSONHandler(os.Stdout, opts)
    } else {
        handler = slog.NewTextHandler(os.Stdout, opts)
    }
}
```

## 選択肢

### 選択肢 1: log/slog（標準ライブラリ）

- **メリット**
  - Go 1.21+ で標準搭載
  - 追加依存なし
  - 構造化ログをネイティブサポート
  - シンプルな API
- **デメリット**
  - 比較的新しく、エコシステムが発展途上

### 選択肢 2: zap

- **メリット**
  - 高パフォーマンス
  - 豊富な機能
  - 広く使われている
- **デメリット**
  - 追加依存が必要
  - API がやや複雑

### 選択肢 3: zerolog

- **メリット**
  - 高パフォーマンス
  - JSON 専用設計
- **デメリット**
  - 追加依存が必要
  - 開発時の可読性がやや低い

### 選択肢 4: logrus

- **メリット**
  - 使いやすい API
- **デメリット**
  - メンテナンスモード（新機能追加なし）
  - パフォーマンスが他より劣る

## 理由

1. **標準ライブラリ**: 外部依存を減らし、長期的な安定性を確保
2. **Go の方向性**: Go チームが推奨する構造化ログの標準
3. **十分な機能**: 本プロジェクトの要件を満たす
4. **将来性**: 今後のエコシステム発展が期待できる

## 結果

- `internal/logger/logger.go` に slog ラッパーを実装
- ミドルウェアでリクエスト ID を付与
- Context 経由でロガーを伝播
- 環境変数 `APP_ENV` でログ形式を切り替え
